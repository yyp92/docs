# http

## HTTP 报文的组成部分

**请求报文**

- 请求行 ( http 方法 + 页面地址 + http 协议 + 版本)
- 请求头( key + value 值)
- 空行(服务端通过空行来判断下一部分不再是请求头，而当做请求体来解析)
- 请求体(数据部分)

**响应报文**

- 状态行 + 响应头 + 空行 + 响应体

## 常见状态码

**状态码分类**

- `1xx`：服务器收到请求
- `2xx`：请求成功，如 `200`
- `3xx`：重定向，如 `302`
- `4xx`：客户端错误，如 `404`
- `5xx`：服务端错误，如 `500`

**常见状态码**

- `200`：成功
- `301`：永久重定向（配合 `location`，浏览器自动处理）
- `302`：临时重定向（配合 `location`，浏览器自动处理）
- `304`：资源未被修改
- `400`:  请求语法错误
- `401`:  未授权
- `403`：没权限
- `404`：资源未找到
- `500`：服务器错误
- `504`：网关超时

![](C:\Users\Administrator\Desktop\docs\imgs\interview-http-1.png)

## 从输入URL到呈现页面过程

### 简洁

- 浏览器的地址栏输入`URL`并按下回车；
- `DNS` 解析：将域名解析成 `IP` 地址；
- `TCP` 连接：`TCP` 三次握手；（三次握手的目的：为了防止已经失效的连接请求报文段突然又传送到了服务器端，从而产生错误）
- 发送 `HTTP` 请求；
- 服务器处理请求并返回 `HTTP` 报文；
- 浏览器解析渲染页面；
- 断开连接：`TCP` 四次挥手

### 详细

**HTTP请求示意图**

![](C:\Users\Administrator\Desktop\docs\imgs\interview-http-2.webp)

> 浏览器中的HTTP请求从发起到结束一共经历了如下八个阶段：构建请求、查找缓存、准备IP和端口、等待TCP队列、建立TCP连接、发起HTTP请求、服务器处理请求、服务器返回请求和断开连接

- 用户输入url并回车
- 浏览器进程检查url，组装协议，构成完整的url
- 浏览器进程通过进程间通信（IPC）把url请求发送给网络进程
- 网络进程接收到url请求后检查本地缓存是否缓存了该请求资源，如果有则将该资源返回给浏览器进程
- **如果没有，网络进程向web服务器发起http请求（网络请求），请求流程如下**：
  - 进行DNS解析，获取服务器`ip`地址，端口
  - 利用`ip`地址和服务器建立`tcp`连接
  - 构建请求头信息
  - 发送请求头信息服务器响应后，网络进程接收响应头和响应信息，并解析响应内容
- **网络进程解析响应流程**:
  - 检查状态码，如果是301/302，则需要重定向，从Location自动中读取地址，重新进行第4步，如果是200，则继续处理请求
  - 200响应处理：检查响应类型Content-Type，如果是字节流类型，则将该请求提交给下载管理器，该导航流程结束，不再进行后续的渲染，如果是html则通知浏览器进程准备渲染进程准备进行染
- **准备渲染进程**
  - 浏览器进程检查当前url是否和之前打开的渲染进程根域名是否相同，如果相同，则复用原来的进程，如果不同，则开启新的渲染进程
- **传输数据、更新状态**
  - 渲染进程准备好后，浏览器向渲染进程发起“提交文档”的消息，渲染进程接收到消息和网络进程建立传输数据的“管道”
  - 渲染进程接收完数据后，向浏览器发送“确认提交”
  - 浏览器进程接收到确认消息后更新浏览器界面状态：安全、地址栏url、前进后退的历史状态、更新web页面

## TCP、UDP相关

### UDP 和 TCP有什么区别

> UDP协议是面向无连接的，不需要在正式传递数据之前先连接起双方，具有不可靠性：不保证有序且不丢失的将数据传递到对端，并且没有任何控制流量的算法。优点是：相比TCP更轻便高效

TCP建立连接和断开连接都需要进行握手，并在数据传输过程中，通过算法来保证数据的可靠性

### TCP为什么要三次握手

> 客户端和服务端都需要直到各自可收发，因此需要三次握手

![](C:\Users\Administrator\Desktop\docs\imgs\interview-http-3.png)

> TCP有6种标示:SYN(建立联机) ACK(确认) PSH(传送) FIN(结束) RST(重置) URG(紧急)

**举例：已失效的连接请求报文段**

- `client`发送了第一个连接的请求报文，但是由于网络不好，这个请求没有立即到达服务端，而是在某个网络节点中滞留了，直到某个时间才到达`server`
- 本来这已经是一个失效的报文，但是`server`端接收到这个请求报文后，还是会想`client`发出确认的报文，表示同意连接。
- 假如不采用三次握手，那么只要`server`发出确认，新的建立就连接了，但其实这个请求是失效的请求，`client`是不会理睬`server`的确认信息，也不会向服务端发送确认的请求
- 但是`server`认为新的连接已经建立起来了，并一直等待`client`发来数据，这样，server的很多资源就没白白浪费掉了
- 采用三次握手就是为了防止这种情况的发生，server会因为收不到确认的报文，就知道`client`并没有建立连接。这就是三次握手的作用

### 三次握手过程中可以携带数据吗

- 第一次、第二次握手不可以携带数据，因为一握二握时还没有建立连接，会让服务器容易受到攻击
- 而第三次握手，此时客户端已经处于 `ESTABLISHED (已建立连接状态)` ，对于客户端来说，已经建立起连接了，并且也已经知道服务器的接收、发送能力是正常的了，所以能携带数据也是没问题的。

### TCP的四次挥手

> 为了确保数据能够完成传输

- 关闭连接时，当收到对方的FIN报文通知时，它仅仅表示对方没有数据发送给你了；但未必你所有的数据都全部发送给对方了
- 所以你未必会马上关闭`SOCKET`,也即你可能还需要发送一些数据给对方之后，再发送FIN报文给对方来表示你同意现在可以关闭连接了，所以它这里的`ACK`报文和FIN报文多数情况下都是分开发送的。

### TCP 和 UDP 的区别

- TCP 是面向连接的，udp 是无连接的即发送数据前不需要先建立链接
- TCP 提供可靠的服务。也就是说，通过 TCP 连接传送的数据，无差错，不丢失， 不重复，且按序到达;UDP 尽最大努力交付，即不保证可靠交付。 并且因为 tcp 可靠， 面向连接，不会丢失数据因此适合大数据量的交换
- TCP 是面向字节流，UDP 面向报文，并且网络出现拥塞不会使得发送速率降低(因 此会出现丢包，对实时的应用比如 IP 电话和视频会议等)
- TCP 只能是 1 对 1 的，UDP 支持 1 对 1,1 对多
- TCP 的首部较大为 20 字节，而 UDP 只有 8 字节
- TCP 是面向连接的可靠性传输，而 UDP 是不可靠的

### HTTP和TCP的不同

- HTTP的责任是去定义数据，在两台计算机相互传递信息时，HTTP规定了每段数据以什么形式表达才是能够被另外一台计算机理解。
- 而TCP所要规定的是数据应该怎么传输才能稳定且高效的传递与计算机之间。
