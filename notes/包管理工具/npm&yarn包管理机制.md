# npm & yarn åŒ…ç®¡ç†æœºåˆ¶

## èƒŒæ™¯

ä½¿ç”¨ npm æˆ– yarn ç®¡ç†é¡¹ç›®ä¾èµ–æ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä»¥ä¸‹ç–‘é—®ï¼š

1. é¡¹ç›®ä¾èµ–å‡ºç°é—®é¢˜æ€ä¹ˆåŠï¼Ÿåˆ äº†é‡è£…ï¼Œå³å…ˆåˆ é™¤ node_modules å†é‡æ–° installï¼Œé‚£è¿™æ ·çš„æ“ä½œä¼šä¸ä¼šå­˜åœ¨é£é™©ï¼Ÿ

2. æŠŠæ‰€æœ‰ä¾èµ–éƒ½å®‰è£…åˆ° dependencies ä¸­ï¼Œä¸åŒºåˆ† devDependencies ä¼šæœ‰é—®é¢˜å—ï¼Ÿ

3. æˆ‘ä»¬çš„åº”ç”¨ä¾èµ–äº† pkg-a å’Œ pkg-bï¼ŒåŒæ—¶ pkg-a ä¹Ÿä¾èµ–äº† pkg-bï¼Œé‚£ä¹ˆ pkg-b ä¼šè¢«å¤šæ¬¡å®‰è£…æˆ–é‡å¤æ‰“åŒ…å—ï¼Ÿ

4. ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä½¿ç”¨ npm åˆ«äººä½¿ç”¨ yarnï¼Œè¿™ä¼šå¼•å‘ä»€ä¹ˆé—®é¢˜ï¼Ÿ

5. æˆ‘ä»¬æ˜¯å¦è¦æäº¤ lockfile(package-lock.json/yarn.lock) åˆ°é¡¹ç›®ä»“åº“å‘¢ï¼Ÿ

6. **lockfile åœ¨ git æ“ä½œæ—¶ï¼Œæ—¶å¸¸ä¼šå‡ºç°å¤§é‡çš„å†²çªï¼Œä½ æ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ**

## npm å†…éƒ¨æœºåˆ¶å’ŒèƒŒåçš„æ€è€ƒ

å…ˆæ¥çœ‹ä¸‹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ**â€œåˆ é™¤ node_modulesï¼Œé‡æ–° npm installâ€**Â è¿™æ ·è§£å†³ä¾èµ–å®‰è£…é—®é¢˜ç™¾è¯•ä¸çˆ½ï¼Œå…¶ä¸­çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ ·åšå­˜åœ¨æ€æ ·çš„é£é™©ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¢ç©¶ä¸€ä¸‹ã€‚

> npm çš„å®‰è£…æœºåˆ¶éå¸¸å€¼å¾—æ¢ç©¶ã€‚pip æ˜¯å…¨å±€å®‰è£…ï¼Œä½† npm çš„å®‰è£…æœºåˆ¶ç§‰æ‰¿äº†ä¸åŒçš„è®¾è®¡å“²å­¦ã€‚

**npm ä¼šä¼˜å…ˆå°†ä¾èµ–åŒ…å®‰è£…åˆ°é¡¹ç›®ç›®å½•ã€‚**Â è¿™æ ·åšçš„å¥½å¤„æ˜¯ä½¿ä¸åŒé¡¹ç›®çš„ä¾èµ–å„æˆä½“ç³»ï¼ŒåŒæ—¶è¿˜å‡è½»äº†åŒ…ä½œè€…çš„ API å‹åŠ›ï¼›ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œå¦‚æœæˆ‘ä»¬çš„Â *repo_a*Â å’ŒÂ *repo_b*Â éƒ½æœ‰ä¸€ä¸ªç›¸åŒçš„ä¾èµ–Â *pkg_c*ï¼Œé‚£ä¹ˆè¿™ä¸ªå…¬å…±ä¾èµ–å°†åœ¨ä¸¤ä¸ªé¡¹ç›®ä¸­å„è¢«å®‰è£…ä¸€æ¬¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ªä¾èµ–å¯èƒ½åœ¨æˆ‘ä»¬çš„ç”µè„‘ä¸Šå¤šæ¬¡å®‰è£…ã€‚

### npm install

![](../../\imgs\npm-vs-yarn-manage-1.png)

ä¸Šå›¾æ˜¯ npm å®‰è£…ä¾èµ–å¤§è‡´çš„è¿‡ç¨‹ï¼Œå…¶ä¸­è¿™æ ·å‡ ä¸ªæ­¥éª¤éœ€è¦å…³æ³¨ï¼š

1. **æ£€æŸ¥é…ç½®**ã€‚åŒ…æ‹¬é¡¹ç›®çº§ã€ç”¨æˆ·çº§ã€å…¨å±€çº§ã€å†…ç½®çš„Â *.npmrc*Â æ–‡ä»¶ã€‚

2. **ç¡®å®šä¾èµ–ç‰ˆæœ¬ï¼Œæ„å»ºä¾èµ–æ ‘**ã€‚ç¡®å®šé¡¹ç›®ä¾èµ–ç‰ˆæœ¬æœ‰ä¸¤ä¸ªæ¥æºï¼Œä¸€æ˜¯ package.json æ–‡ä»¶ï¼Œä¸€æ˜¯ lockfile æ–‡ä»¶,ä¸¤ä¸ªç¡®è®¤ç‰ˆæœ¬ã€æ„å»ºä¾èµ–æ ‘çš„æ¥æºï¼Œäº’ä¸å¯å°‘ã€ç›¸è¾…ç›¸æˆã€‚å¦‚æœ package-lock.json æ–‡ä»¶å­˜åœ¨ä¸”ç¬¦åˆ package.json å£°æ˜çš„çš„æƒ…å†µä¸‹ï¼Œç›´æ¥è¯»å–ï¼›å¦åˆ™é‡æ–°ç¡®è®¤ä¾èµ–çš„ç‰ˆæœ¬ã€‚

3. **ä¸‹è½½åŒ…èµ„æº**ã€‚ä¸‹è½½å‰å…ˆç¡®è®¤æœ¬åœ°æ˜¯å¦å­˜åœ¨åŒ¹é…çš„ç¼“å­˜ç‰ˆæœ¬ï¼Œå¦‚æœæœ‰å°±ç›´æ¥ä½¿ç”¨ç¼“å­˜æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸‹è½½å¹¶æ·»åŠ åˆ°ç¼“å­˜ï¼Œç„¶åå°†åŒ…æŒ‰ä¾èµ–æ ‘è§£å‹åˆ° node_modules ç›®å½•ã€‚

4. **ç”Ÿæˆ lockfile æ–‡ä»¶ã€‚**

å¯ä»¥ç¡®è®¤è¿™æ ·å‡ ä¸ªé€»è¾‘ï¼š

1. æ„å»ºä¾èµ–æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œç‰ˆæœ¬ç¡®è®¤éœ€è¦ç»“åˆ package.json å’Œ package-lock.json ä¸¤ä¸ªæ–‡ä»¶ã€‚å…ˆç¡®è®¤ package-lock.json å®‰è£…ç‰ˆæœ¬ï¼Œç¬¦åˆè§„åˆ™å°±ä»¥æ­¤ä¸ºå‡†ï¼Œå¦åˆ™ç”± package.json å£°æ˜çš„ç‰ˆæœ¬èŒƒå›´é‡æ–°ç¡®è®¤ã€‚ç‰¹åˆ«åœ°ï¼Œè‹¥æ˜¯åœ¨å¼€å‘ä¸­æ‰‹åŠ¨æ›´æ”¹åŒ…ä¿¡æ¯ï¼Œä¼šå¯¼è‡´lockfile ç‰ˆæœ¬ä¿¡æ¯å¼‚å¸¸ï¼Œä¹Ÿå¯èƒ½ç”± package.json ç¡®è®¤ã€‚ç¡®è®¤å¥½çš„ä¾èµ–æ ‘ä¼šå­˜åˆ° package-lock.json æ–‡ä»¶ä¸­ï¼Œè¿™é‡Œè·Ÿ yarn.lock å­˜åœ¨å·®å¼‚ã€‚

2. åŒä¸€ä¸ªä¾èµ–ï¼Œæ›´é«˜ç‰ˆæœ¬çš„åŒ…ä¼šå®‰è£…åˆ°é¡¶å±‚ç›®å½•ï¼Œå³ node_modules ç›®å½•ï¼›å¦åˆ™ä¼šåˆ†æ•£åœ¨æŸäº›ä¾èµ–çš„ node_modules ç›®å½•ï¼Œå¦‚ï¼šnode_modules/expect-jsx/node_modules/react ç›®å½•ã€‚

3. å¦‚æœä¾èµ–å‡çº§ï¼Œé€ æˆç‰ˆæœ¬ä¸å…¼å®¹ï¼Œéœ€è¦å¤šç‰ˆæœ¬å…±å­˜ï¼Œé‚£ä¹ˆä»ç„¶æ˜¯å°†é«˜ç‰ˆæœ¬å®‰è£…åˆ°é¡¶å±‚ï¼Œä½ç‰ˆæœ¬åˆ†æ•£åˆ°å„çº§ç›®å½•ã€‚

4. lockfile çš„å­˜åœ¨ï¼Œä¿è¯äº†é¡¹ç›®ä¾èµ–ç»“æ„çš„ç¡®å®šæ€§ï¼Œä¿éšœäº†é¡¹ç›®åœ¨å¤šç¯å¢ƒè¿è¡Œçš„ç¨³å®šæ€§ã€‚

5. ...

## yarn å®‰è£…ç†å¿µä»¥åŠç ´è§£ä¾èµ–ç®¡ç†å›°å¢ƒ

yarn ä½œä¸ºåŒºåˆ«äº npm çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œè¯ç”Ÿä¹‹åˆå°±æ˜¯ä¸ºäº†è§£å†³å†å²ä¸Š npm çš„æŸäº›ä¸è¶³ï¼Œæ¯”å¦‚ npm ç¼ºä¹å¯¹äºä¾èµ–çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ä¿éšœï¼Œä»¥åŠ npm å®‰è£…é€Ÿåº¦è¿‡æ…¢çš„é—®é¢˜ç­‰ï¼Œå°½ç®¡ npm å‘å±•è‡³ä»Šï¼Œå·²ç»åœ¨å¾ˆå¤šæ–¹é¢å‘ yarn çœ‹é½ï¼Œä½† yarn çš„å®‰è£…ç†å¿µä»ç„¶éœ€è¦æˆ‘ä»¬å…³æ³¨ã€‚yarn æå‡ºçš„å®‰è£…ç†å¿µå¾ˆå¥½çš„è§£å†³äº†å½“æ—¶ npm çš„ä¾èµ–ç®¡ç†é—®é¢˜ï¼š

1. **ç¡®å®šæ€§**ã€‚é€šè¿‡ yarn.lock ç­‰æœºåˆ¶ï¼Œä¿è¯äº†ç¡®å®šæ€§ï¼Œè¿™é‡Œçš„ç¡®å®šæ€§åŒ…æ‹¬ä½†ä¸é™äºæ˜ç¡®çš„ä¾èµ–ç‰ˆæœ¬ã€æ˜ç¡®çš„ä¾èµ–å®‰è£…ç»“æ„ç­‰ã€‚å³åœ¨ä»»ä½•æœºå™¨å’Œç¯å¢ƒä¸‹ï¼Œéƒ½å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è¢«å®‰è£…ã€‚

2. **æ¨¡å—æ‰å¹³åŒ–å®‰è£…**ã€‚å°†ä¾èµ–åŒ…çš„ä¸åŒç‰ˆæœ¬ï¼ŒæŒ‰ç…§ä¸€å®šç­–ç•¥ï¼Œå½’ç»“ä¸ºå•ä¸ªç‰ˆæœ¬ï¼Œä»¥é¿å…åˆ›å»ºå¤šä¸ªå‰¯æœ¬é€ æˆå†—ä½™ã€‚ï¼ˆnpm ä¹Ÿæœ‰ç›¸åŒçš„ä¼˜åŒ–)

3. **æ›´å¥½çš„ç½‘ç»œæ€§èƒ½**ã€‚Yarn é‡‡ç”¨äº†è¯·æ±‚æ’é˜Ÿçš„ç†å¿µï¼Œç±»ä¼¼å¹¶å‘è¿æ¥æ± ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨ç½‘ç»œèµ„æºï¼›åŒæ—¶å¼•å…¥äº†æ›´å¥½çš„å®‰è£…å¤±è´¥æ—¶çš„é‡è¯•æœºåˆ¶ã€‚ï¼ˆnpm è¾ƒæ—©çš„ç‰ˆæœ¬æ˜¯é¡ºåºä¸‹è½½ï¼Œå½“ç¬¬ä¸€ä¸ªåŒ…å®Œå…¨ä¸‹è½½å®Œæˆåï¼Œæ‰ä¼šå°†ä¸‹è½½æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªåŒ…)

4. **å¼•å…¥ç¼“å­˜æœºåˆ¶ï¼Œå®ç°ç¦»çº¿ç­–ç•¥ã€‚ï¼ˆnpm ä¹Ÿæœ‰ç±»ä¼¼çš„ä¼˜åŒ–)**

### yarn.lock æ–‡ä»¶ç»“æ„

ä»¥ react ç­‰ä¾èµ–ä¸ºä¾‹ï¼Œå…ˆå¤§è‡´äº†è§£ä¸€ä¸‹ yarn.lock æ–‡ä»¶çš„ç»“æ„ä»¥åŠç¡®å®šä¾èµ–ç‰ˆæœ¬çš„æ–¹å¼ï¼š

```bash
# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY. 
# yarn lockfile v1 
expect-jsx@^5.0.0: 
 version "5.0.0" 
 resolved "[http://registry.npmjs.org/expect-jsx/-/expect-jsx-5.0.0.tgz#61761b43365f285a80eb280c785e0783bbe362c7](http://registry.npmjs.org/expect-jsx/-/expect-jsx-5.0.0.tgz#61761b43365f285a80eb280c785e0783bbe362c7 "http://registry.npmjs.org/expect-jsx/-/expect-jsx-5.0.0.tgz#61761b43365f285a80eb280c785e0783bbe362c7")" 
 integrity sha1-YXYbQzZfKFqA6ygMeF4Hg7vjYsc= 
 dependencies: 
 collapse-white-space "^1.0.0" 
react "^16.0.0"
 react-element-to-jsx-string "^13.0.0" 
react-rater@^6.0.0: 
 version "6.0.0" 
 resolved "[http://registry.npmjs.org/react-rater/-/react-rater-6.0.0.tgz#2e666b6e5e5c33b622541df6a7124f6c99606927](http://registry.npmjs.org/react-rater/-/react-rater-6.0.0.tgz#2e666b6e5e5c33b622541df6a7124f6c99606927 "http://registry.npmjs.org/react-rater/-/react-rater-6.0.0.tgz#2e666b6e5e5c33b622541df6a7124f6c99606927")" 
 integrity sha512-NP1+rEeL3LyJqA5xF7U2fSHpISMcVeMgbQ0u/P1WmayiHccI7Ixx5GohygmJY82g7SxdJnIun2OOB6z8WTExmg== 
 dependencies: 
 prop-types "^15.7.2" 
react "^16.8.0"
 react-dom "^16.8.0" 
//ä¸€æˆ–å¤šä¸ªå…·æœ‰ç›¸åŒç‰ˆæœ¬èŒƒå›´çš„ä¾èµ–å£°æ˜ï¼Œç¡®å®šä¸€ä¸ªå¯ç”¨çš„ç‰ˆæœ¬ã€‚è¿™å°±æ˜¯ lockfile çš„ç¡®å®šæ€§ã€‚
react@^16.0.0, react@^16.8.0:
version "16.14.0"
 resolved "[http://registry.npmjs.org/react/-/react-16.14.0.tgz#94d776ddd0aaa37da3eda8fc5b6b18a4c9a3114d](http://registry.npmjs.org/react/-/react-16.14.0.tgz#94d776ddd0aaa37da3eda8fc5b6b18a4c9a3114d "http://registry.npmjs.org/react/-/react-16.14.0.tgz#94d776ddd0aaa37da3eda8fc5b6b18a4c9a3114d")" 
 integrity sha512-0X2CImDkJGApiAlcf0ODKIneSwBPhqJawOa5wCtKbu7ZECrmS26NvtSILynQ66cgkT/RJ4LidJOc3bUESwmU8g== 
 dependencies: 
 loose-envify "^1.1.0" 
 object-assign "^4.1.1" 
 prop-types "^15.6.2" 
//å¦‚æœåŒä¸€ä¸ªä¾èµ–å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ï¼Œé‚£ä¹ˆæœ€é«˜ç‰ˆæœ¬å®‰è£…åœ¨é¡¶å±‚ç›®å½•ï¼Œå³ node_modules ç›®å½•ã€‚
react@^17.0.1:
version "17.0.2"
 resolved "[http://registry.npmjs.org/react/-/react-17.0.2.tgz#d0b5cc516d29eb3eee383f75b62864cfb6800037](http://registry.npmjs.org/react/-/react-17.0.2.tgz#d0b5cc516d29eb3eee383f75b62864cfb6800037 "http://registry.npmjs.org/react/-/react-17.0.2.tgz#d0b5cc516d29eb3eee383f75b62864cfb6800037")" 
 integrity sha512-gnhPt75i/dq/z3/6q/0asP78D0u592D5L1pd7M8P+dck6Fu/jJeL6iVVK23fptSUZj8Vjf++7wXA8UNclGQcbA== 
 dependencies: 
 loose-envify "^1.1.0" 
 object-assign "^4.1.1"
```

ä»ä¸Šé¢ä¾èµ–ç‰ˆæœ¬æè¿°çš„ä¿¡æ¯ä¸­ï¼Œå¯ä»¥ç¡®å®šä»¥ä¸‹å‡ ç‚¹ï¼š

- æ‰€æœ‰ä¾èµ–ï¼Œä¸ç®¡æ˜¯é¡¹ç›®å£°æ˜çš„ä¾èµ–ï¼Œè¿˜æ˜¯ä¾èµ–çš„ä¾èµ–ï¼Œéƒ½æ˜¯æ‰å¹³åŒ–ç®¡ç†ã€‚

- ä¾èµ–çš„ç‰ˆæœ¬æ˜¯ç”±æ‰€æœ‰ä¾èµ–çš„ç‰ˆæœ¬å£°æ˜èŒƒå›´ç¡®å®šçš„ï¼Œå…·å¤‡ç›¸åŒç‰ˆæœ¬å£°æ˜èŒƒå›´çš„ä¾èµ–å½’ç»“ä¸ºä¸€ç±»ï¼Œç¡®å®šä¸€ä¸ªè¯¥èŒƒå›´ä¸‹çš„ä¾èµ–ç‰ˆæœ¬ã€‚å¦‚æœåŒä¸€ä¸ªä¾èµ–å¤šä¸ªç‰ˆæœ¬å…±å­˜ï¼Œé‚£ä¹ˆä¼šå¹¶åˆ—å½’ç±»ã€‚

- æ¯ä¸ªä¾èµ–ç¡®å®šçš„ç‰ˆæœ¬ä¸­ï¼Œæ˜¯ç”±ä»¥ä¸‹å‡ é¡¹æ„æˆï¼š
  
  - å¤šä¸ªä¾èµ–çš„å£°æ˜ç‰ˆæœ¬ï¼Œä¸”ç¬¦åˆ semver è§„èŒƒï¼›
  
  - ç¡®å®šçš„ç‰ˆæœ¬å· version å­—æ®µï¼›
  
  - ç‰ˆæœ¬çš„å®Œæ•´æ€§éªŒè¯å­—æ®µ
  
  - ä¾èµ–åˆ—è¡¨
  
  - **ç›¸æ¯” npmï¼ŒYarn ä¸€ä¸ªæ˜¾è‘—åŒºåˆ«æ˜¯ yarn.lock ä¸­å­ä¾èµ–çš„ç‰ˆæœ¬å·ä¸æ˜¯å›ºå®šç‰ˆæœ¬ã€‚**Â ä¹Ÿå°±æ˜¯è¯´å•ç‹¬ä¸€ä¸ª yarn.lock ç¡®å®šä¸äº† node_modules ç›®å½•ç»“æ„ï¼Œè¿˜éœ€è¦å’Œ package.json æ–‡ä»¶è¿›è¡Œé…åˆã€‚

### yarn install

ä»¥ä¸‹æ˜¯åœ¨ yarn å®‰è£…ä¾èµ–æ—¶çš„æ­¥éª¤ï¼š

![](../../\imgs\npm-vs-yarn-manage-2.png)

1ã€æ£€æŸ¥ï¼ˆcheckingï¼‰

ä¸»è¦æ˜¯æ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦å­˜åœ¨ä¸€äº› npm ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ package-lock.json ç­‰ã€‚å¦‚æœå­˜åœ¨ï¼Œå¯èƒ½ä¼šè­¦å‘Šæç¤ºï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šå­˜åœ¨å†²çªã€‚åœ¨è¿™ä¸€é˜¶æ®µï¼Œä¹Ÿä¼šæ£€æŸ¥ç³»ç»Ÿ OSã€CPU ç­‰ä¿¡æ¯ã€‚

2ã€è§£æåŒ…ï¼ˆresolving packagesï¼‰

è¿™ä¸€æ­¥ä¸»è¦æ˜¯è§£æä¾èµ–æ ‘ï¼Œç¡®å®šç‰ˆæœ¬ä¿¡æ¯ç­‰ã€‚é¦–å…ˆè·å–é¡¹ç›® package.json ä¸­å£°æ˜çš„é¦–å±‚ä¾èµ–ï¼ŒåŒ…æ‹¬ dependencies, devDependencies, optionalDependencies å£°æ˜çš„ä¾èµ–ã€‚æ¥ç€é‡‡ç”¨éå†é¦–å±‚ä¾èµ–çš„æ–¹å¼è·å–ä¾èµ–åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥åŠé€’å½’æŸ¥æ‰¾æ¯ä¸ªä¾èµ–ä¸‹åµŒå¥—ä¾èµ–çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¹¶å°†è§£æè¿‡å’Œæ­£åœ¨è§£æçš„åŒ…ç”¨ä¸€ä¸ª Set æ•°æ®ç»“æ„æ¥å­˜å‚¨ï¼Œè¿™æ ·å°±èƒ½ä¿è¯åŒä¸€ä¸ªç‰ˆæœ¬èŒƒå›´å†…çš„åŒ…ä¸ä¼šè¢«é‡å¤è§£æã€‚

- å¯¹äºæ²¡æœ‰è§£æè¿‡çš„åŒ…ï¼Œé¦–æ¬¡å°è¯•ä» yarn.lock ä¸­è·å–åˆ°ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¹¶æ ‡è®°ä¸ºå·²è§£æï¼›

- å¦‚æœåœ¨ yarn.lock ä¸­æ²¡æœ‰æ‰¾åˆ°åŒ…ï¼Œåˆ™å‘ Registry å‘èµ·è¯·æ±‚è·å–æ»¡è¶³ç‰ˆæœ¬èŒƒå›´çš„å·²çŸ¥æœ€é«˜ç‰ˆæœ¬çš„åŒ…ä¿¡æ¯ï¼Œè·å–åå°†å½“å‰åŒ…æ ‡è®°ä¸ºå·²è§£æã€‚

æ€»ä¹‹ï¼Œåœ¨ç»è¿‡å¤æ‚çš„è§£æç®—æ³•åï¼Œæˆ‘ä»¬å°±ç¡®å®šäº†æ‰€æœ‰ä¾èµ–çš„å…·ä½“ç‰ˆæœ¬ä¿¡æ¯ä»¥åŠä¸‹è½½åœ°å€ã€‚

3ã€è·å–åŒ…ï¼ˆfetching packagesï¼‰

è¿™ä¸€æ­¥ä¸»è¦æ˜¯åˆ©ç”¨ç³»ç»Ÿç¼“å­˜ï¼Œåˆ°ç¼“å­˜ä¸­æ‰¾åˆ°å…·ä½“çš„åŒ…èµ„æºã€‚é¦–å…ˆä¼šå°è¯•åœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾ä¾èµ–åŒ…ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œåˆ™å°†ä¾èµ–åŒ…ä¸‹è½½åˆ°ç¼“å­˜ä¸­ã€‚å¯¹äºæ²¡æœ‰å‘½ä¸­ç¼“å­˜çš„åŒ…ï¼ŒYarn ä¼šç»´æŠ¤ä¸€ä¸ª fetch é˜Ÿåˆ—ï¼ŒæŒ‰ç…§è§„åˆ™è¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚è¿™é‡Œä¹Ÿæ˜¯ yarn è¯ç”Ÿä¹‹åˆè§£å†³ npm v3 å®‰è£…ç¼“æ…¢é—®é¢˜çš„ä¼˜åŒ–ç‚¹ï¼Œæ”¯æŒå¹¶è¡Œä¸‹è½½ã€‚

å¦‚ä½•åˆ¤æ–­æœ‰æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Ÿ

åˆ¤æ–­ç³»ç»Ÿä¸­å­˜åœ¨ç¬¦åˆ "**cachefolder+slug+node_modules+pkg.name**" è§„åˆ™çš„è·¯å¾„ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ¤æ–­ä¸ºå‘½ä¸­ç¼“å­˜ï¼Œå¦åˆ™å°±ä¼šé‡æ–°ä¸‹è½½ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸åŒç‰ˆæœ¬çš„åŒ…åœ¨ç¼“å­˜ä¸­æ˜¯æ‰å¹³åŒ–ç®¡ç†ã€‚ä»¥ä¸‹æ˜¯ç¼“å­˜ä¸­ webpack çš„ä¾èµ–ç¼“å­˜ï¼Œå¯ä»¥é€šè¿‡ yarn cache dir æŸ¥çœ‹ã€‚

![](../../\imgs\npm-vs-yarn-manage-3.png)

4ã€é“¾æ¥åŒ…ï¼ˆlinking dependenciesï¼‰

è¿™ä¸€æ­¥ä¸»è¦æ˜¯å°†ç¼“å­˜ä¸­çš„ä¾èµ–ï¼Œå¤åˆ¶åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼ŒåŒæ—¶éµå¾ªæ‰å¹³åŒ–åŸåˆ™ã€‚å‰é¢è¯´åˆ°ï¼Œnpm ä¼˜å…ˆå°†ä¾èµ–å®‰è£…åˆ°é¡¹ç›®ç›®å½•ï¼Œå› æ­¤éœ€è¦å°†å…¨å±€ç¼“å­˜ä¸­çš„ä¾èµ–å¤åˆ¶åˆ°é¡¹ç›®ã€‚åœ¨å¤åˆ¶ä¾èµ–å‰ï¼ŒYarn ä¼šå…ˆè§£æ peerDependenciesï¼Œå¦‚æœæ‰¾ä¸åˆ°ç¬¦åˆ peerDependencies å£°æ˜çš„ä¾èµ–ç‰ˆæœ¬ï¼Œåˆ™è¿›è¡Œ warning æç¤ºï¼ˆè¿™å¹¶ä¸ä¼šå½±å“å‘½ä»¤æ‰§è¡Œï¼‰ï¼Œå¹¶æœ€ç»ˆæ‹·è´ä¾èµ–åˆ°é¡¹ç›®ä¸­ã€‚

5ã€æ„å»ºåŒ…ï¼ˆbuilding fresh packageï¼‰

å¦‚æœä¾èµ–åŒ…ä¸­å­˜åœ¨äºŒè¿›åˆ¶åŒ…éœ€è¦è¿›è¡Œç¼–è¯‘ï¼Œä¼šåœ¨è¿™ä¸€æ­¥è¿›è¡Œã€‚

### å¦‚æœç ´è§£ä¾èµ–ç®¡ç†å›°å¢ƒ

åœ¨ npm v2 æ—¶æœŸï¼Œå®‰è£…çš„ä¾èµ–ä¼šå­˜åœ¨äºå¼•ç”¨ä¾èµ–çš„ node_modules ç›®å½•ï¼Œå¦‚æœä¾èµ–è¿‡å¤šï¼Œä¼šå½¢æˆä¸€é¢—å·¨å¤§çš„ä¾èµ–æ ‘ã€‚è¿™ç§ç»“æ„è™½ç„¶ç®€å•æ˜äº†ï¼Œä½†æ˜¯å¯¹äºå¤§å‹é¡¹ç›®ååˆ†ä¸å‹å¥½ã€‚ä¾èµ–å±‚çº§æ·±å¯¹å¼€å‘æ’æŸ¥ä¸åˆ©ï¼Œå¹¶ä¸”ä¾èµ–çš„å¤ç”¨ä¹Ÿæ˜¯é—®é¢˜ã€‚åœ¨ npm v3 ä¸­å¼•å…¥æ‰å¹³åŒ–çš„æ¦‚å¿µã€‚çœ‹å‡ ä¸ªåœºæ™¯çš„ä¾‹å­ğŸŒ°ï¼š

åœºæ™¯ä¸€ï¼šä¸åŒ npm ç‰ˆæœ¬å®‰è£…ä¾èµ–çš„ç»“æ„

> pkg-a@1.0.0 ä¾èµ– pkg-b@1.0.0ï¼Œnpm v3 æ˜¯æ‰å¹³åŒ–ç®¡ç†ä¾èµ–ã€‚

![](../../\imgs\npm-vs-yarn-manage-4.png)

åœºæ™¯äºŒï¼šä¸åŒ npm ç‰ˆæœ¬å¤„ç†ä¾èµ–å¤šç‰ˆæœ¬å…±å­˜é—®é¢˜Â 

> åœ¨åœºæ™¯ä¸€çš„åŸºç¡€ä¸Šï¼Œå®‰è£… pkg-c@1.0.0ï¼Œè€Œå®ƒä¾èµ–å¦ä¸€ä¸ªç‰ˆæœ¬çš„ pgk-b@2.0.0ã€‚ç”±äºæ ¹ç›®å½•ä¸‹å·²å­˜åœ¨ pkg-b@1.0.0 çš„ä¾èµ–ï¼Œnpm v3 ä¼šæŠŠ pkg-b@2.0.0 å®‰è£…åˆ° pkg-c@1.0.0 ä¾èµ–çš„ node_modules ç›®å½•ã€‚

![](../../\imgs\npm-vs-yarn-manage-5.png)

é“ä»”ç–‘æƒ‘ï¼šä¸ºä»€ä¹ˆ pkg-b@1.0.0 åœ¨é¡¶çº§ï¼Œè€Œ pkg-b@2.0.0 åœ¨å­çº§å‘¢ï¼Ÿ

åœºæ™¯ä¸‰ï¼šä¾èµ–çš„å¤šç‰ˆæœ¬çš„æ•°é‡ä¸ä¾èµ–ç‰ˆæœ¬åˆ†å¸ƒå…³ç³»Â 

> åœ¨åœºæ™¯äºŒçš„åŸºç¡€ä¸Šï¼Œå®‰è£… pkg-d@1.0.0ï¼Œè€Œå®ƒä¹Ÿä¾èµ– pkg-b@2.0.0ã€‚åŒæ ·çš„ï¼Œç”±äºæ ¹ç›®å½•ä¸‹å·²å­˜åœ¨ pkg-b@1.0.0 çš„ä¾èµ–ï¼Œnpm v3 ä¼šæŠŠ pkg-b@2.0.0 å®‰è£…åˆ° pkg-d@1.0.0 ä¾èµ–çš„ node_modules ç›®å½•ã€‚

![](../../\imgs\npm-vs-yarn-manage-6.png)

é“ä»”ç–‘æƒ‘ï¼šä½ å¯èƒ½ä¼šç–‘é—®ï¼Œæ­¤æ—¶å­˜åœ¨2ä¸ª pkg-b@2.0.0 å’Œ1ä¸ª pkg-b@1.0.0ï¼Œå‡ºç°åœ¨é¡¶çº§å®‰è£…ç›®å½•çš„ä¸åº”è¯¥æ˜¯ v2 ç‰ˆæœ¬è€Œé v1 ç‰ˆæœ¬å˜›ï¼Ÿ

å…¶å®è¿™æ˜¯ç”±ä¾èµ–çš„å®‰è£…é¡ºåºå†³å®šçš„ï¼ŒçœŸå°±æ˜¯ä¾èµ–çš„æŸä¸ªç‰ˆæœ¬å¦‚æœå‡ºç°åœ¨åˆé€‚çš„æ—¶é—´ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«å®‰è£…åˆ°é¡¶çº§ node_modules ç›®å½•ã€‚ä¸åŒç‰ˆæœ¬çš„å‡ºåœºé¡ºåºå¯¼è‡´ä¾èµ–ç»“æ„çš„å·®å¼‚ï¼Œnpm v3 æ³¨å®šä¸æ˜¯ç¨³å®šçš„åŒ…ç®¡ç†å·¥å…·ã€‚è·Ÿç”Ÿæ´»ä¸€æ ·ï¼Œäººç‰©çš„å‡ºåœºé¡ºåºå¾ˆé‡è¦ï¼Œå®ƒå†³å®šäº†ä½ åœ¨å“ªé‡Œåšä»€ä¹ˆäº‹ã€‚

åœºæ™¯å››ï¼šä¾èµ–ç‰ˆæœ¬å­˜åœ¨é‡å¤å’Œå¯ç”¨Â 

> åœ¨åœºæ™¯ä¸‰çš„åŸºç¡€ä¸Šï¼Œå®‰è£… pkg-e@1.0.0ï¼Œå®ƒä¾èµ– pkg-b@1.0.0ã€‚ç”±äºé¡¶çº§ç›®å½•å·²å­˜åœ¨ç›®æ ‡ç‰ˆæœ¬ï¼Œå› æ­¤ npm v3 ä¼šè·³è¿‡è¯¥ä¾èµ–çš„å®‰è£…ã€‚

![](../../\imgs\npm-vs-yarn-manage-7.png)

åœºæ™¯äº”ï¼šç‰ˆæœ¬å‡çº§å›§å¢ƒåœ¨

> åœºæ™¯ä¸‰çš„åŸºç¡€ä¸Šï¼Œå¦‚æœæ›´æ–°äº† pkg-a@2.0.0ï¼ŒåŒæ—¶å®ƒçš„ä¾èµ–æ˜¯ pkg-b@2.0.0ã€‚é‚£ä¹ˆ npm v3 çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼Œåˆ é™¤ pkg-a@1.0.0ï¼Œå®‰è£… pkg-a@2.0.0ï¼Œå®‰è£… pkg-b@2.0.0ï¼Œç•™ä¸‹äº† pkg-b@1.0.0 åœ¨é¡¶å±‚ç›®å½•ï¼Œå› æ­¤ pkg-b@2.0.0 ä¼šå®‰è£…åˆ°å…¶çˆ¶ä¾èµ–çš„ node_modules ç›®å½•ã€‚

![](../../\imgs\npm-vs-yarn-manage-8.png)

åœºæ™¯å…­ï¼šä¾èµ–ç‰ˆæœ¬å¤šç›®å½•å­˜åœ¨ä¸”ç¬¦åˆå¤ç”¨æ¡ä»¶Â 

> åœ¨åœºæ™¯äº”çš„åŸºç¡€ä¸Šï¼Œæ›´æ–° pkg-e@2.0.0ï¼Œå®ƒä¾èµ–äº† pkg-b@2.0.0ã€‚é‚£ä¹ˆ npm v3 çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼Œåˆ é™¤ pkg-a@1.0.0ï¼Œå®‰è£… pkg-e@2.0.0ï¼Œåˆ é™¤ pkg-b@1.0.0ï¼Œå®‰è£… pkg-b@2.0.0ï¼Œäºæ˜¯å‡ºç°ä»¥ä¸‹ç»“æ„ã€‚

![](../../\imgs\npm-vs-yarn-manage-9.png)

æ­¤æ—¶ä½ ä¼šå‘ç°ï¼Œå­˜åœ¨å¤šä¸ª pkg-b@2.0.0 åˆ†å¸ƒåœ¨ä¸åŒçš„ node_modules ç›®å½•ï¼Œä»–ä»¬æ˜¯ä¸æ˜¯åªè¦åœ¨é¡¶çº§ç›®å½•å­˜åœ¨ä¸€ä»½å³å¯ï¼Ÿæ²¡é”™ï¼Œæˆ‘ä»¬åˆ é™¤ node_modules ç›®å½•é‡è£…ï¼Œå¾—åˆ°çš„å°±æ˜¯ä½ æƒ³çš„æ¸…æ™°çš„ç»“æ„ã€‚

![](../../\imgs\npm-vs-yarn-manage-10.png)

å®é™…ä¸Šï¼Œæ›´ä¼˜é›…çš„æ–¹å¼æ˜¯ä½¿ç”¨ npm dedupe å‘½ä»¤è¾¾åˆ°ä¸Šè¿°ç»“æ„ã€‚è€Œ yarn åœ¨å®‰è£…ä¾èµ–æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œ dedupe å‘½ä»¤ã€‚

æ­£æ˜¯ç”±äºä¸Šè¿°ä¸€äº› npm å†å²çš„å‘ï¼Œæ‰€ä»¥æ›´å»ºè®®ä½¿ç”¨ yarn ä½œä¸ºé¡¹ç›®åä½œçš„åŒ…ç®¡ç†å·¥å…·ã€‚å½“ç„¶ npm å‘å±•è‡³ä»Šï¼Œå¾ˆå¤šé—®é¢˜å·²ç»ä¼˜åŒ–æ‰ï¼Œç°åœ¨ yarn å’Œ npm æ˜¯ä¸¤æ¬¾äº’ç›¸çœ‹é½ã€äº’ç›¸è·å–çµæ„Ÿçš„ä¾èµ–ç®¡ç†å·¥å…·ã€‚

## npm vs. yarn ğŸ’ª

> è¿™é‡Œç®€å•å¯¹æ¯” npm v6 å’Œ yarn v1. è¿™æ˜¯æˆ‘ä»¬ç”Ÿäº§å¼€å‘å¸¸ç”¨çš„ç‰ˆæœ¬ã€‚

npm å’Œ yarn ä½œä¸ºä¸¤æ¬¾ç›¸ä¼¼çš„åŒ…ç®¡ç†å·¥å…·ï¼Œåœ¨ä¸€äº›åŠŸèƒ½å®ç°ä¸Šå®ƒä»¬äº’ç›¸è·å–çµæ„Ÿã€‚

ç›¸åŒç‚¹ï¼š

1. package.json ä½œä¸ºé¡¹ç›®ä¾èµ–æè¿°æ–‡ä»¶ã€‚

2. node_modules ä½œä¸ºä¾èµ–å­˜å‚¨ç›®å½•ï¼Œyarn v2 ä¸å†æ˜¯è¿™æ ·ã€‚

3. lockfile é”å®šç‰ˆæœ¬ä¾èµ–ï¼Œåœ¨ yarn ä¸­å« yarn.lockï¼Œåœ¨ npm ä¸­å« package-lock.jsonï¼Œåœ¨ npm v7 ä¹Ÿæ”¯æŒäº† yarn.lockã€‚å®ƒç¡®ä¿åœ¨ä¸åŒæœºå™¨æˆ–ä¸åŒç¯å¢ƒä¸­ï¼Œèƒ½å¤Ÿå¾—åˆ°ç¨³å®šçš„ node_modules ç›®å½•ç»“æ„ã€‚

å·®å¼‚ï¼š

1. ä¾èµ–ç®¡ç†ç­–ç•¥ã€‚

2. lockfileã€‚package-lock.json è‡ªå¸¦ç‰ˆæœ¬é”å®š+ä¾èµ–ç»“æ„ï¼Œä½ æƒ³æ”¹åŠ¨ä¸€äº›ä¾èµ–ï¼Œå¯èƒ½å½±å“çš„èŒƒå›´è¦æ¯”è¡¨é¢çœ‹èµ·æ¥çš„å¤æ‚çš„å¤šï¼›è€Œ yarn.lock è‡ªå¸¦ç‰ˆæœ¬é”å®šï¼Œå¹¶æ²¡æœ‰ç¡®å®šçš„ä¾èµ–ç»“æ„ï¼Œä½¿ç”¨ yarn ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œéœ€è¦ package.json + yarn.lock å…±åŒç¡®å®šä¾èµ–çš„ç»“æ„ã€‚

3. æ€§èƒ½ã€‚ï¼ˆå¯¹æ¯” npm v6 å’Œ yarn v1ï¼‰ç›®å‰ npm v7 ä¼˜åŒ–äº†ç¼“å­˜å’Œä¸‹è½½ç½‘ç»œç­–ç•¥ï¼Œæ€§èƒ½çš„å·®å¼‚åœ¨ç¼©å°ã€‚

![](../../\imgs\npm-vs-yarn-manage-11.png)

## [æ‹“å±•] npm ä¼ä¸šçº§éƒ¨ç½²ç§æœåŸç†

**npm ä¸­çš„æºï¼ˆregistryï¼‰ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæŸ¥è¯¢æœåŠ¡ã€‚**ä»¥ npmjs.org ä¸ºä¾‹ï¼Œå®ƒçš„æŸ¥è¯¢æœåŠ¡ç½‘å€æ˜¯ https://registry.npmjs.org/ ï¼Œåœ¨è¿™ä¸ªç½‘å€ååŠ ä¸Šä¾èµ–çš„åå­—ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ª JSON å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº†ä¾èµ–æ‰€æœ‰çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š

- https://registry.npmjs.org/react

- https://registry.npm.taobao.org/react

æˆ‘ä»¬å¯ä»¥é€šè¿‡Â **npm config set registry**Â å‘½ä»¤æ¥è®¾ç½®å®‰è£…æºã€‚ä½ çŸ¥é“æˆ‘ä»¬å…¬å¸ä¸ºä»€ä¹ˆè¦éƒ¨ç½²ç§æœ‰çš„ npm é•œåƒå—ï¼Ÿè™½ç„¶ npm å¹¶æ²¡æœ‰è¢«å±è”½ï¼Œä½†æ˜¯ä¸‹è½½ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…çš„é€Ÿåº¦ä¾ç„¶è¾ƒç¼“æ…¢ï¼Œè¿™ä¸¥é‡å½±å“ CI/CD æµç¨‹æˆ–æœ¬åœ°å¼€å‘æ•ˆç‡ã€‚é€šå¸¸æˆ‘ä»¬è®¤ä¸ºéƒ¨ç½² npm ç§æœå…·å¤‡ä»¥ä¸‹ä¼˜ç‚¹ï¼š

1. ç¡®ä¿é«˜é€Ÿã€ç¨³å®šçš„ npm æœåŠ¡

2. ç¡®ä¿å‘å¸ƒç§æœ‰æ¨¡å—çš„å®‰å…¨æ€§

3. å®¡æ ¸æœºåˆ¶å¯ä»¥ä¿éšœç§æœä¸Š npm æ¨¡å—è´¨é‡å’Œå®‰å…¨

**éƒ¨ç½²ä¼ä¸šçº§ç§æœï¼Œèƒ½å¤Ÿè·å¾—å®‰å…¨ã€ç¨³å®šã€é«˜é€Ÿçš„ä¿éšœã€‚**

## ç®¡ç†é¡¹ç›®ä¾èµ–çš„å°æŠ€å·§ï¼ˆé›†æ€å¹¿ç›Š...ï¼‰

1. æ¨èä½¿ç”¨ yarn ä½œä¸ºå›¢é˜ŸåŒ…ç®¡ç†å·¥å…·ï¼Œè€Œä¸æ˜¯ npmã€‚å°½ç®¡åœ¨ npm v6 ä¹‹åçš„ç‰ˆæœ¬è¶‹å‘ç¨³å®šå’Œå®‰å…¨ï¼Œä½†ç”±äºå†å²åŸå› å’Œå›¢é˜Ÿç®¡ç†å…¼å®¹æ€§ï¼Œä»ç„¶æ˜¯æ¨èä½¿ç”¨ yarn ä½œä¸ºå›¢é˜Ÿç»Ÿä¸€çš„åŒ…ç®¡ç†å·¥å…·ã€‚

2. é¡¹ç›®ä¸­ä¸€å®šè¦å­˜åœ¨ lockfile æ–‡ä»¶ï¼Œä¸”ç¦æ­¢æ‰‹åŠ¨ä¿®æ”¹ï¼Œå› ä¸ºè¿™æ˜¯é¡¹ç›®ç¨³å®šæ€§è¿è¡Œçš„ä¿éšœã€‚

3. å¦‚æœ yarn.lock åœ¨ä»£ç åˆå¹¶çš„è¿‡ç¨‹ä¸­å‡ºç°äº†é—®é¢˜ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ yarn install è§£å†³é—®é¢˜ã€‚

4. ...

## å‚è€ƒèµ„æ–™

[1] npm install:Â  https://docs.npmjs.com/cli/v7/commands/npm-install

[2] yarn install:Â  https://classic.yarnpkg.com/en/docs/cli/install 

[3] yarn.lock:Â  https://classic.yarnpkg.com/en/docs/yarn-lock

[4] NPM vs. Yarn: Which Package Manager Should You Choose?:Â  https://www.whitesourcesoftware.com/free-developer-tools/blog/npm-vs-yarn-which-should-you-choose/

[5] Lockfiles should be committed on all projects:Â  https://classic.yarnpkg.com/blog/2016/11/24/lockfiles-for-all/
