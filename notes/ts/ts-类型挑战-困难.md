# ts ç±»å‹ä½“æ“æŒ‘æˆ˜ - å›°éš¾

## ç®€å•çš„ Vue ç±»å‹

> [æŒ‘æˆ˜è¦æ±‚](https://github.com/type-challenges/type-challenges/blob/main/questions/00006-hard-simple-vue/README.zh-CN.md) 
> [åœ¨çº¿ç¤ºä¾‹](https://www.typescriptlang.org/play?#code/PQKgUABBBsELQUAHehVZUCFuEBqBXAphQ3j6DR6pPHGeSQEYCeEAggHYAuAFgPYO0BiWEAFAAEAhswBmWAJQQAxIAe1QH1pM1gEsAzjKEAHTQBtlAYyFNlHGQDdcJEtJsRAGRmA7tytRAedqAG53yAeeWw5URQPSmgIDGqIiAaMqAEk6ANOaAQAzOEIBYCYDj8YALxoDZ8oAAcoBUcoC-ioAOpgAGAMrKALa6OD75gBD-XoBxcvk+AHQ4AB5MOAwAJvmAaEb5nTiiygw4AMJsZRwdTPmAkP+AMP+AwdqAKXqAp9GAxtaAdh6ADOqAFcaAtaaAX4oQ+hOaWO2dEIAxKhAlOKxsneqAoYqAFwmo+Sqq+USxUCRABTqgBNrQCIxoAMI0AtHLzQCIRoAbuUA4gqAPuiiqVypVAKXGgHXlQBXyoAyPUAkOb9IxCfLzfKnMoXHDda75e6PZ75QDq2oBW61QAHlKAArHD6JiAHXlAFxygDdFQD0qulUIAh5Vy8zicGJTFJgHozLIoVB5JaAFfjAHtqWTSgCg5QDQcoBw0y+LDU+VQgE-tQCGMfNAGLyysABvKAA9NAKs2gMVpMhgHbgwBryiLAGtyqEAhdGAdO9AHo6gHIDHqATtN3f8ICQFZTzpd8srAGA65stwuNJo1uRt9sA2-GAGQj0oBsuQjgDc9XWAZb9ADnm0UBBchy0ALWaAJnSI4dUIAeBUAMAGAWDllXkkyn6Q92Ezx8W7fMRQXAPpyQtzP2ieUhgHvlQCncoB+6MAd6neskUs7U7p7wBTysHp4yfpDUD3UGzohBz1SM4A4OXvs5+qAjoAMCqANJygAgmoC9QMv++RtqakKAJDGgD5yoA7BY9kKE5xKiZQ6BUuBWrqA5EPuyqAN9ygDwhqgk5QPktFMKoJCnAwqhMBAwwsSI+h4AAvBAxQ4XhOB8AA3iQUCdCSfBSKJUCyRAABODxYPJDAQDJcmyUM8ksQwQj3AAXBAADkAAq1CaDgRkADRiRpOhCDpek4IZRmjCwQg6LhDAAOY4Ko1m2XJelsFgzCGQAjAADDZGkQAAvrZcUxbJaaXoZ6lyeInm6fcUlqYFsmKUwymqd8jRaY59wQAA1MZdW1WV9mVTgBUJXJSW2dBTyqOlBUWnlGUaR5ODyUwfBlVlOg5TgjRMGwAAybAAO4jaMDlCRIEitYlJBxVtNG0XEAB8ECAhAADiyisFglAQAagCn5oA0O6AFj-LBMEwmg9cAwD0foLCNNyqiNGw8necA0DAAAXiwcCjAAcmAIDAGAKOgBAAD6mNY9jWMQM6qCAMdygCAHhjONk+jEBI6jIAgBAAYnBelwQE+EDfJTyNMOZeDjF+NIACIkgAPCZJ28epADaAAKbGqQA1jg1BsKIEAmQAuoZJlS6rECtO0XTqHl3EncMogjRAABKEAAPwWxAGta2ACVgJzFkQBymjGBwgt81ZECjL7ACyvsC0qEC8XzOttB0zz8FIRsy6b8m2zbluGSMZgjaL+XiSShk+4xjM0oZowQAAZCrFqqGZFneySR3JV1zyGQHZcV2o1c4ILLflyHQitzz6b80LoxHfXjutyZlcd4L6eZyjAz6PZikQOIDD8iYqn8eiuDe77-sQAHR18GwHsbz1bun17Pt+4HR0SIZIjUCjYBo+TZMQIA0raAKvRgAUroA0fKkzfrjKmaIQasRdngYSEAACiABHLAHlfbQJaBZfk8UV7yQmMZAQEC4B-Q8l5XyqhgAXGUDofyKMt64R8CJEgEklQDVst9CAODVBwFaKgpg7D5KYPkrZCayhtJMGmkw4ALD6LsJQXyLhI1eH8Mro0XyTBzYiE6BMKSojxFsI4dI7hci5JlXoUIDRtkiolWzhpCqwinIuQ7gFWKTVrEGWMm5AhHQiH2KGiUEKYUIBRWSlANq8VkqpUuL1TKWBspOUYbFMxKkPwABJhICKEdNOKEAkmNQck4nAcV8iJWSh1KAjdz6DSUSoro6jpIFTiapAORh-ryVUVUgptl+rVNisNUa40FHBVCkwfaQ1cLdImpEqaTlZoLWWqtdaUlBlBWGWNMq5TmklDma0gxfkxodI0kxFiK8xnTTDqzBRk0RGxT2axQwqg-KGXFsgzhgs4EIJ0ILCBSsDlRPuL7Fi8lhjeVHtrXi4ttYOQgI-DZwTHZbWfq-IBuMjTpEAKbWgD4XsxfuAKAJ1ABgSoAarl8aAGPIwAKt6vXep9fS31fr-UBsDUG4NgAiFUCteSUMYbwxICdJ6xLSUfS+j9VQf0AZAxBmDCGqg2A6FIRwBiWKICABezQAWJqOB5eSylArqXCrpdDWGCMqZgCAA)

### é¢˜æ„

å®ç°ç±»ä¼¼Vueçš„ç±»å‹æ”¯æŒçš„ç®€åŒ–ç‰ˆæœ¬ã€‚

é€šè¿‡æä¾›ä¸€ä¸ªå‡½æ•° `SimpleVue`ï¼ˆç±»ä¼¼äº`Vue.extend`æˆ–`defineComponent`ï¼‰ï¼Œå®ƒåº”è¯¥æ­£ç¡®åœ°æ¨æ–­å‡º computed å’Œ methods å†…éƒ¨çš„ `this` ç±»å‹ã€‚

åœ¨æ­¤æŒ‘æˆ˜ä¸­ï¼Œæˆ‘ä»¬å‡è®¾ `SimpleVue` æ¥å—åªå¸¦æœ‰ `data`ï¼Œ`computed` å’Œ `methods` å­—æ®µçš„Objectä½œä¸ºå…¶å”¯ä¸€çš„å‚æ•°ï¼Œ

- `data` æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªæä¾›ä¸Šä¸‹æ–‡ `this` çš„å¯¹è±¡ï¼Œä½†æ˜¯ä½ æ— æ³•åœ¨ `data` ä¸­è·å–å…¶ä»–çš„è®¡ç®—å±æ€§æˆ–æ–¹æ³•ã€‚

- `computed` æ˜¯å°† `this` ä½œä¸ºä¸Šä¸‹æ–‡çš„å‡½æ•°çš„å¯¹è±¡ï¼Œè¿›è¡Œä¸€äº›è®¡ç®—å¹¶è¿”å›ç»“æœã€‚åœ¨ä¸Šä¸‹æ–‡ä¸­åº”æš´éœ²è®¡ç®—å‡ºçš„å€¼è€Œä¸æ˜¯å‡½æ•°ã€‚

- `methods` æ˜¯å‡½æ•°çš„å¯¹è±¡ï¼Œå…¶ä¸Šä¸‹æ–‡ä¹Ÿä¸º `this`ã€‚å‡½æ•°ä¸­å¯ä»¥è®¿é—® `data`ï¼Œ`computed` ä»¥åŠå…¶ä»– `methods` ä¸­çš„æš´éœ²çš„å­—æ®µã€‚Â `computed` ä¸ `methods` çš„ä¸åŒä¹‹å¤„åœ¨äº `methods` åœ¨ä¸Šä¸‹æ–‡ä¸­æŒ‰åŸæ ·æš´éœ²ä¸ºå‡½æ•°ã€‚

`SimpleVue` çš„è¿”å›å€¼ç±»å‹å¯ä»¥æ˜¯ä»»æ„çš„ã€‚

```ts
const instance = SimpleVue({
  data() {
    return {
      firstname: 'Type',
      lastname: 'Challenges',
      amount: 10,
    }
  },
  computed: {
    fullname() {
      return this.firstname + ' ' + this.lastname
    }
  },
  methods: {
    hi() {
      alert(this.fullname.toLowerCase())
    }
  }
})
```

### é¢˜è§£

```ts
/** è·å– computed ä¸­çš„ this */
type ComputedData<T> = {
  [P in keyof T]: T[P] extends () => infer R ? R : T[P]
}

type Option<D, C, M, Data = D extends () => infer R ? R : never> = {
  data: D,
  computed: C & ThisType<Data>,
  methods: M & ThisType<M & Data & ComputedData<C>>,
} & ThisType<never>

declare function SimpleVue<D, C, M>(options: Option<D, C, M>): any


// ä½¿ç”¨ç¤ºä¾‹
SimpleVue({
  data() {
    // @ts-expect-error
    this.firstname
    // @ts-expect-error
    this.getRandom()
    // @ts-expect-error
    this.data()

    return {
      firstname: 'Type',
      lastname: 'Challenges',
      amount: 10,
    }
  },
  computed: {
    fullname() {
      return `${this.firstname} ${this.lastname}`
    },
  },
  methods: {
    getRandom() {
      return Math.random()
    },
    hi() {
      alert(this.amount)
      alert(this.fullname.toLowerCase())
      alert(this.getRandom())
    },
    test() {
      const fullname = this.fullname
      const cases: [Expect<Equal<typeof fullname, string>>] = [] as any
    },
  },
})
```

ä¸ºäº†è®¾ç½®ä¸åŒåŒºåŸŸçš„ this å¯¹è±¡çš„ç±»å‹ï¼Œéœ€è¦ç”¨åˆ°å†…ç½®å·¥å…·ç±»å‹ [ThisType](https://www.typescriptlang.org/docs/handbook/utility-types.html#thistypetype) ã€‚

é¦–å…ˆäº†è§£ä¸€ä¸‹ `ThisType` çš„ç”¨æ³•ï¼Œä¸‹é¢å®šä¹‰äº†ä¸€æ®µä»£ç ï¼š

> [åœ¨çº¿ç¤ºä¾‹](https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgCJzHZBvAUM5ADwC5kQBXAWwCNoAafZAT1IpulwF9dcB6X5GCYAHFAHlqAK2QBeHHwEEAJhjil0mBQWRwlS0gAoAlLIB8ZKrShbuQ0cgnS5eZavWrGu-cmNmL7a05kADJkABUAC2AAZzCRCAAeDThTHgQAexBosGR0qVJHWXlXTFIXbRJkAEYGbWZSACZa5E5m-h09X3L2gigIMHIoEEEo6IA6FUwxwmQAahGYidUxpgBuRnbuAi8uxl7+weGwUem5hfG1xm5OIA)

```ts
interface Data {
  x: number,
  y: number
}

type Obj = {
  data: Data
  add: () => number
}

const obj: Obj = {
  data: {
    x: 1,
    y: 2,
  },
  add() {
    // è¿™é‡Œ this å°±æ˜¯ obj å¯¹è±¡ï¼Œç±»å‹åˆ™å¯¹åº” Obj
    return this.data.x + this.data.y;
  }
}
```

ä½†æ˜¯æˆ‘æƒ³æ”¹å˜ä¸€ä¸‹è¿™ä¸ª `this` å¯¹è±¡çš„ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥è¿™ä¹ˆåšï¼š

```ts
// ä½¿ç”¨å†…ç½®å·¥å…·ç±»å‹ ThisType å£°æ˜ä¸Šä¸‹æ–‡ this  çš„ç±»å‹
type Obj = {
  data: Data
  add: () => number
} & ThisType<Data>

const obj: Obj = {
  data: {
    x: 1,
    y: 2,
  },
  add() {
    // æ­¤æ—¶ this çš„ç±»å‹å·²ç»æ˜¯ Data äº†
    return this.x + this.y;
  }
}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ ThisType éœ€è¦**å¼€å¯é…ç½®**Â **noImplicitThis**ã€‚

å¼„æ˜ç™½ ThisType åï¼Œå†å›åˆ°ä¸Šé¢çš„ç­”æ¡ˆä¸­ï¼Œå°±èƒ½æ˜ç™½æ˜¯æ€ä¹ˆå›äº‹äº†ï¼š

```ts
/*
  data æ˜¯å‡½æ•°ï¼Œcomputed å’Œ methods éƒ½æ˜¯å¯¹è±¡ã€‚
  æ‰€ä»¥ï¼Œé’ˆå¯¹ä¸åŒèŒƒå›´çš„ä¸Šä¸‹æ–‡ï¼Œéœ€è¦å•ç‹¬å¤„ç†ã€‚

  data çš„ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯ options
  computed ä¸­å‡½æ•°çš„ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯ options.computed
  methods ä¸­å‡½æ•°çš„ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯ options.methods
  æ‰€ä»¥ä½¿ç”¨ ThisType ç»™å¯¹åº”çš„å¯¹è±¡è¿›è¡Œå¤„ç†å³å¯
*/
type Option<D, C, M, Data = D extends () => infer R ? R : never> = {
  data: D,
  computed: C & ThisType<Data>,
  methods: M & ThisType<M & Data & ComputedData<C>>,
} & ThisType<never>

/*
  å®šä¹‰æ³›å‹ Dã€Cã€M ç”¨æ¥è·å– dataã€
  computedã€methods çš„ç±»å‹
*/
declare function SimpleVue<D, C, M>(options: Option<D, C, M>): any
```

## æŸ¯é‡ŒåŒ– 1

> [æŒ‘æˆ˜è¦æ±‚](https://github.com/type-challenges/type-challenges/blob/main/questions/00017-hard-currying-1/README.zh-CN.md) 
> [åœ¨çº¿ç¤ºä¾‹](https://www.typescriptlang.org/play?#code/PQKgUABBCMDsEFoKHvzQM4mDRlGlEN37ARgJ4QCCAdgC4AWA9uSQGICuEAFAAICGVAZswEoIAYkAPaoD60kVwBO0rkWzZhyiIAyMwHduiqAD4IgRldA7DGAZa0BXgYAqlQN-+gRejAMP+Aia0Bz8RAAKAJQiBOU0Db8dcAUsYHnEwCAGLQhtQAp1QBNrQERjQAwjQFo5QC+9QDrowH95QApXABUiAAcAUwBlAGNpAEtsyggAFgA6AAYQgG0AYWZZIhLyAHMAXUAIf+pKSmyAZwAuYGBc8mqAdxKAazLcgBMSrmraaU7gOcXgFraOzsBIf8B6M0AAOUBZz0AwHUAyPUBIc0AsTUAqOUAh5UAHU0AQt0BfxXfAG3jAEbGgC45QDz1s8Huc3l9foB4vUA6EqfQABRoB6c2CUGwgGj5QBBmoAsf5CAANCZRhthCvRhhUuMtlhAALzsLijCDkZgAWwIuWkABoIAQmSz2ZyhLTdFwIABqXmk8kVGjSXK5OkQKnLNjQHkAJgEITJ5ApEEKrVKK1I1KVB2k7S6bBV2qguv1vBKADdFfTDbISibqWwtWwAMx2iCE-EhQAE8oAkBMAm374i1Wzr4n7vQD3yoBfgKeUJsgAqDQAA6YBAyMAxtaAOw9AHSpgFNFQDB2miINhIrE4jYPcblr9zoBCa0Ao3KAUuNAOvKkI+gUAYEqAWUTADHagAEje4fQBwKjYK4AUvUAK-GAPbVAG6KgGW-QA55tXsLowhAAOIlGjMAgQQBQcoBT80A0O44gZDMYTYmFajVABWww2W2AcGAAC9qAQJoADkwBAYAwEg0AIAAfTg+CEPgiBAAN5T5AGO5QBAD1gxCcJgiBwKg4AIEAEb9AFGI34wEoHJFQAWRWEo2QAHgyHlXF0WlsAyCBcgAD0oKZlmGCAGg6XhOQgRgeWqaTRPEgBRbpsCgAB+BktiZRhhV0OjViYuTWO0bAmVcABuSDllyQoABsZEVfhyEKSgSnoCA4yOZjtDYXhyCZDIBFGTjuL4gShLYaTqhkToxggWTpDILZhi0mLyDEuL3CUiBVJ0hjWUY0gEoMmsoH5XJXWkSCwGg3CcIgQBpW0AVei0gxbDqqQgiSlZbJNllaiIAAbwgOSAEdmC4KyeTkni8kciAAF8IF4aRaFZCAAHIOCovIEBfMarKmTpcmGYBmCcqzhlWyCHQqJsvWWaBzSNeM2BtJkKVKLoeT5Zk2Q5bkDSZAhaFoPaeCSyhpGYXJtSug0jVujUHsOa0XogN6jk+-kfs5HlCgBoGQfIHlljx4Hch4HlchJgmeV4V7wfRiBOipsnyDBiGocgzbFUKLhhkOpUGmwSbpsoRjhtGqzGIyrnaF4WHPRWdUGTp97OiStgvoFX71dx3l8ZZtnId3bQuSFqbLNF8WxqlqAoBluWbpWDUeRRtGunVzWsekHXmdBuldDYYm9dJv2RXYSng4J9XadR+n3f99gmcjg2E-Bo2dBNsBFIqqrWqQwBoOXOQBTaxavP8Ig0BdwgQdAGq5VDAGPIwAVbzvQYRnGYBn1fD8v22X8eGGGZOX-QCQKrm8m5bh928799P02XvYGAYZgZO5y9SrwAXs0eDRJ7bp9hhfWee+HoDQIIsAgA)

### é¢˜æ„

> åœ¨æ­¤æŒ‘æˆ˜ä¸­å»ºè®®ä½¿ç”¨TypeScript 4.0

[æŸ¯é‡ŒåŒ–](https://en.wikipedia.org/wiki/Currying)Â æ˜¯ä¸€ç§å°†å¸¦æœ‰å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢ä¸ºæ¯ä¸ªå¸¦æœ‰ä¸€ä¸ªå‚æ•°çš„å‡½æ•°åºåˆ—çš„æŠ€æœ¯ã€‚

ä¾‹å¦‚ï¼š

```ts
const add = (a: number, b: number) => a + b
const three = add(1, 2)

const curriedAdd = Currying(add)
const five = curriedAdd(2)(3)
```

ä¼ é€’ç»™Â `Currying`Â çš„å‡½æ•°å¯èƒ½æœ‰å¤šä¸ªå‚æ•°ï¼Œæ‚¨éœ€è¦æ­£ç¡®è¾“å…¥å®ƒçš„ç±»å‹ã€‚

åœ¨æ­¤æŒ‘æˆ˜ä¸­ï¼ŒæŸ¯é‡ŒåŒ–åçš„å‡½æ•°æ¯æ¬¡ä»…æ¥å—ä¸€ä¸ªå‚æ•°ã€‚æ¥å—å®Œæ‰€æœ‰å‚æ•°åï¼Œå®ƒåº”è¿”å›å…¶ç»“æœã€‚

### é¢˜è§£

```ts
// ç»„è£…å‡½æ•°
type Medium<T, R> =
  T extends [infer F, ...infer E]
    ? (arg: F) => Medium<E, R>
    : R;

declare function Currying<T>(fn: T):
  T extends (...args: infer Args) => infer R 
    ? Medium<Args, R> 
    : never


// ä½¿ç”¨ç¤ºä¾‹ï¼š
const add = (a: number, b: number) => a + b
const three = add(1, 2)

const curriedAdd = Currying(add)
const five = curriedAdd(2)(3)
```

- åœ¨ [æ¡ä»¶ç±»å‹](https://www.typescriptlang.org/docs/handbook/2/conditional-types.html) ä¸­ä½¿ç”¨ `infer` è·å–å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼
- ç„¶åéå†æ•°ç»„ `Args` ï¼Œä½¿ç”¨é€’å½’çš„æ–¹å¼ç»„è£…å‡½æ•°å³å¯

ä¸€å¼€å§‹æˆ‘æ˜¯è¿™ä¹ˆæ¥è·å–å‡½æ•°è¿”å›å€¼çš„ç±»å‹çš„ï¼š

```ts
declare function Currying<T extends any[], R>(fn: (...args: T) => R): Medium<T, R>

/*
  å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼Œæœ€åçš„è¿”å›å€¼ä¸å¤Ÿå‡†ç¡®ï¼Œä¸æ˜¯ true
  const curried1: (arg: string) => boolean
*/
const curried1 = Currying((a: string) => true)


// åé¢æˆ‘æ¢äº†ç§æ–¹å¼å†è·å–å‡½æ•°çš„è¿”å›å€¼
declare function Currying<T extends (...args: any[]) => unknown>(fn: T): ReturnType<T>
// curried1 çš„ç±»å‹è¿˜æ˜¯ boolean..
const curried1 = Currying((a: string) => true)
```

åæ¥æ˜¯å»åˆ°è§£ç­”åŒºçœ‹åˆ°äº†è¿™ä¸ª[è§£ç­”](https://github.com/type-challenges/type-challenges/issues/1404)ï¼Œæ‰çŸ¥é“è¦æŠŠè¿™ä¸ªç±»å‹æ¨å¯¼æ”¾åˆ°æœ€ç»ˆç»“æœå¤„å»è¿›è¡Œå¤„ç†ï¼š

```ts
declare function Currying<T>(fn: T): 
  T extends (...args: any[]) => infer R ? R : never

// è¿™æ¬¡ curried1 çš„ç±»å‹æ˜¯ true äº†ï¼Œè·å¾—äº†å…·ä½“çš„å­—é¢é‡ç±»å‹
const curried1 = Currying((a: string) => true)
```

çœ‹äº†è§£ç­”åŒºçš„è¯´æ˜åï¼Œè®¤ä¸ºé—®é¢˜æ˜¯å‡ºåœ¨å‡½æ•°çš„å®šä¹‰ä¸Šï¼š

```ts
// 3ç§è¯»å–å‡½æ•°çš„è¿”å›å€¼çš„æµ‹è¯•ä»£ç ï¼š
declare function f1(a: string): true  // å‡½æ•°å£°æ˜
declare var f2: (a: string) => true  // åŒ¿åå‡½æ•°è¡¨è¾¾å¼

// ç¬¬ä¸€ç§ï¼Œé€šè¿‡æ³›å‹åœ¨å‚æ•°ä¸­å®šä¹‰ã€‚
declare function test1<R>(fn: (...args: any[]) => R): R;
test1(f1) // true âœ…
test1(f2) // true âœ…
test1((a: string) => true) // boolean âŒ

// ç¬¬äºŒç§ï¼Œé€šè¿‡æ³›å‹çº¦æŸä¸Šå»å®šä¹‰ã€‚
declare function test2<F extends (...args: any[]) => any>(fn: F): ReturnType<F>;
test2(f1) // true âœ…
test2(f2) // true âœ…
test2((a: string) => true) // boolean âŒ

// ç¬¬ä¸‰ç§ï¼Œåœ¨æ³›å‹æœ€ç»ˆåº”ç”¨ç»“æœå¤„å†åšåˆ¤å®šã€‚å¯ä»¥çœ‹å‡ºåªæœ‰è¿™ç§æ–¹æ³•çš„æ•ˆæœæœ€å¥½ï¼Œä¹Ÿæ˜¯ç¬¦åˆæµ‹è¯•caseçš„è¦æ±‚
declare function test3<F>(fn: F): F extends (...args: any[]) => any ? ReturnType<F> : never;
test3(f1) // true âœ…
test3(f2) // true âœ…
test3((a: string) => true) // true âœ…
```

## Union to Intersectionï¼ˆè”åˆè½¬äº¤å‰ï¼‰

> [æŒ‘æˆ˜è¦æ±‚](https://github.com/type-challenges/type-challenges/blob/main/questions/00055-hard-union-to-intersection/README.zh-CN.md) 
> [åœ¨çº¿ç¤ºä¾‹](https://www.typescriptlang.org/play?#code/PQKgUABBCs0QtBAqgOwJYHsUQC4YgJIo4CmATgM4kDGOmKkC8zLjARgJ4QBaAFiQJQBzCAAoAAgC9+goQEoIAYkAPaoD60pQFc6AGwpK0KAGblGjReYiAMjMB3bqagA+CIEZXQOwxgGWtAV4GAKpUDf-oEXowBh-wCJrQDn4iAAFACUIQE5TQG34-0AKWMB5xMAgBjsIQDztQAbnQA2swHK-LTRtQG8fQGj1AANUegAVDCJSSho6LAAeJHsKjMBo+UAgzQyKwZwKRhwOAAcSQggAXmR0LAAmBvIqWnpWgHJDDAxNiAAfCAAWRcPcMg0SR2BgCBIAD0naEgATXHw2Ke3d-YAyE5nAE4S4kRiDLpQRiOQAU6hAAOJoHC8DRsCCAKDlAKfmgGh3QBY-7wcDhxhQAFy3YbUXgAOgAVhQqRgyEJgLBgNJ4ABhAByYBAwDAAtAEAA+qKxeKxRBAAbygBC3QDHcoBADxFEpVwogfIFY0m81q9WIq2aGw6swgjFESHuD1IKFeegAhiguAB+MR2pkk5AKGaOB1cD0oEgAN3ICke1ttrvdEAMxjIhC9jkDGDQr0YUBdBFNUH9QZMgpAytV4oggGlbQCr0YAKV26haLovV-LQAFtxoycLgJlMAN4QACiAEcNHbtAAaXtPZoQAC+EEMZAwjYgm3EWpI8EpQ+0JGEJAowCKuk2mo7EGodqoejmAG1GD3x7RWv3B9p2gsUHUVk11m0fntzqdziCVz2KOP7-ICEDAqC9jATed44A+A5Di+uofmsLQoK0oiiAmi47HsChHFhaAeqcOGASQcjAWI2GzI4oEKACREkYsZGgpRMEALoCvmNa1hAgDQcoAAHKAKbWvFFvWYCgNCECAGBKgDVcrKgDHkYAKt74oSxJksAFLUnSDJMiy0DAA6FAAO7kGyvCcjyDgQDiKlqUSpLkhQlK0vSjLMqyFAYNoRRYCMNmAC9mgBYmjYDkac5rm6R5FlWby-JgEAA)

### é¢˜æ„

å®ç°é«˜çº§å·¥å…·ç±»å‹Â `UnionToIntersection<U>`

ä¾‹å¦‚ï¼š

```ts
// expected to be 'foo' & 42 & true
type I = UnionToIntersection<'foo' | 42 | true>
```

### é¢˜è§£

```ts
type UnionToIntersection<U> = 
  (U extends any ? (arg: U) => any : never) extends (arg: infer I) => void
    ? I 
    : never

// ç»“æœï¼š'foo' & 42 & true
type I = Union2Intersection<'foo' | 42 | true>
```

> ç­”æ¡ˆå‚è€ƒè‡ª [è§£ç­”åŒº](https://github.com/type-challenges/type-challenges/issues/122) ğŸ‘æ¯”è¾ƒå¤šçš„

å½“ä½¿ç”¨ `infer` æ¨æ–­ä¼šå‘ç”Ÿ [**é€†å˜**](https://juejin.cn/post/7138063352139350023#heading-2) çš„ç±»å‹ä¸­æ—¶ï¼Œåˆ™æ¨æ–­ç»“æœä¼šå¾—åˆ°ä¸€ä¸ª**äº¤å‰ç±»å‹**ï¼š

> [åœ¨çº¿ç¤ºä¾‹](https://www.typescriptlang.org/play?#code/C4TwDgpgBAQghgJwDwBUB8UC8UBQUopQQAewEAdgCYDOUA3lHAFxQAUxLAluQGYQJQAqgEosGAG4B7TpQDcUAEYt2XXvyGjME6ZSgBfPPigB+IYZbkI4-rJw4A9PajVgCbgHMcoSAQCMWWEQkBmY2DmdXD01tGXklMJYXN3J3aKgpGX00eQcnJI8oADIocgBXAFsFfi9waBQAJgD4ZBDlcPyUtIy5RTaLCqqELp0s+SA)

```ts
type Bar<T> = 
  T extends { a: (x: infer U) => void; b: (x: infer U) => void }
    ? U
    : never;

// string
type T1 = Bar<{ a: (x: string) => void; b: (x: string) => void }>; 
// string & number
type T2 = Bar<{ a: (x: string) => void; b: (x: number) => void }>; 
```

åœ¨ [å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html#:~:text=The%20following%20example%20demonstrates) ä¸­æœ‰ `infer` å¯¹åº”çš„è¯´æ˜ã€‚

æ‰€ä»¥ä»£å…¥åˆ°ä¸Šé¢çš„è§£ç­”ä¸ç¤ºä¾‹ä¸­å¯ä»¥è¿™ä¹ˆå»çœ‹ï¼š

> æ³¨æ„ï¼šè”åˆç±»å‹ä½œç”¨äºæ³›å‹æ—¶ä¼šå‘ç”Ÿåˆ†å¸ƒè¡Œä¸º

```ts
type UnionToIntersection<'foo' | 42 | true> = 
  ((arg: 'foo') => any | (arg: 42) => any | (arg: true) => any) extends (inferArg: infer I) => void
    ? I 
    : never
```

ä¹Ÿå°±ç¬¦åˆäº†ä¸Šé¢è¯´çš„ `infer` æ¨æ–­æƒ…å†µï¼Œå› ä¸º `inferArg` çš„ç±»å‹å­˜åœ¨**é€†å˜**ï¼Œæ‰€ä»¥è¯¥ç±»å‹å¿…é¡»æ˜¯ `'foo' & 42 & true`ï¼Œè¿™æ ·æ‰èƒ½æ»¡è¶³ã€‚ä½†æ˜¯æ€ä¹ˆå¯èƒ½æœ‰ç±»å‹æ˜¯ `'foo' & 42 & true` å‘¢ï¼Œæ‰€ä»¥æœ€åä¼šå¾—åˆ° `never`ã€‚

## Get Requiredï¼ˆä¿ç•™æ‰€æœ‰å¿…å¡«å­—æ®µï¼‰

> [æŒ‘æˆ˜è¦æ±‚](https://github.com/type-challenges/type-challenges/blob/main/questions/00057-hard-get-required/README.zh-CN.md) 
> [åœ¨çº¿ç¤ºä¾‹](https://www.typescriptlang.org/play?#code/PQKgUABBCsDsEFoIHECmAXCAlVBHArgJYBOqAJpIgtTZQEYCeEAWgBaocB2A5hABQABAF7su3AJQQAxIAe1QH1p0-OkIAbAM7TCnAGapilSlKMRAGRmA7twNQAfBECMroHYYwDLWgK8DAFUqBv-0CL0YBh-wETWgOfiIAAUsCEBOU0Bt+K9ACljAecTAIAZLCEA87UAG50ANrMByvyVVQG8fQGj1AAM0dBwCEnIAHgAVK0LvQFPogsBd+UBNV0ABI0BIc0BR-UBrDUB1bUBW6yTAaPlAIM0kwqn0NUp0BgAHVAgASQgAXhQMMqJSMkqAbwhtAHsTgC4ITnwAWzo9ABoIOgBDYgB+S7V0Yi1eAF8bMBgBBUAAPJYAY3Q5Ag6BOz2WR1OFyut3uxAg-0oU0KSRsgAp1FCEdCsfB0CCAKDlAKfmgGh3QBY-6x0OgFmpzsCZpDWAA6ABWam5J2I3GAcGAIgQAGEAHJgEDAMCK0AQAD6avVGvVEEABvKAELdAMdygEAPVWa00qiDyxXzJZbUp4XZVWobA6UADaQQgWggAGtUAwTtoINUIC8NNV3QBdUFgmGcMgaHYVfa1SMQd7BCCXTioABuegjl3DQQjYGxSpAJrNGoggGlbQCr0YAKVxGlaraotCsINwWQsw1qREAAogQXiongOIahoVjjsQTjcIAByAR9hBckcqVA8VBqYA5dQLq2LZaQ0PbjYQV2UcdQ9CVIf4EeVEqJvaHY5nLPovQAbmeb0+EDfL8PBYlYTzIh+aJ3HooFgVeE7Qnew4qE+2z2kmb4opc+Bxqg2haOQv6vB82G4fh2ZkKB4HvqiOFkHhBGUYCcEloqYDKq21aANBygAAcoAptYtq27bseA1gQIAYEqANVyeqAMeRgAq3oyzKsuywCcjy-KCsKoqwMALycGoADuejiqwUqymJdLyYpLJshyahcnyApCiKYpqCcKg5Cc+mUDYgAvZoAWJrmNZyl2Q5GnOSZZlygqYBAA)

### é¢˜æ„

å®ç°é«˜çº§å·¥å…·ç±»å‹Â `GetRequired<T>`ï¼Œè¯¥ç±»å‹ä¿ç•™æ‰€æœ‰å¿…éœ€çš„å±æ€§

ä¾‹å¦‚ï¼š

```ts
// expected to be { foo: number }
type I = GetRequired<{ foo: number, bar?: string }> 
```

### é¢˜è§£

```ts
type GetRequired<T> = {
  [P in keyof T as T[P] extends Required<T>[P] ? P : never]: T[P]
}


// ä½¿ç”¨ç¤ºä¾‹ï¼šexpected to be { foo: undefined }
type I = GetRequired<{ foo: undefined; bar?: undefined }>
```

> ç­”æ¡ˆå‚è€ƒè‡ª [è§£ç­”åŒº](https://github.com/type-challenges/type-challenges/issues/285)

ä¸Šé¢ç”¨åˆ°äº†å·¥å…·ç±»å‹ `Required`ï¼Œæºç å¦‚ä¸‹ï¼š

```ts
type Required<T> = { [P in keyof T]-?: T[P]; }
```

é¦–å…ˆä½¿ç”¨åˆ°äº†Â [as](https://www.typescriptlang.org/docs/handbook/2/mapped-types.html#key-remapping-via-as)Â è¿›è¡Œé”®çš„é‡æ–°æ˜ å°„ï¼Œç„¶åé€šè¿‡ `Required` å°†å¯¹è±¡çš„å±æ€§å˜ä¸ºå¿…é€‰çš„ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ `-?` æ¥è¿›è¡Œå¤„ç†ï¼Œè¿™æ · `TS` å°±èƒ½å‡†ç¡®åœ°è¯†åˆ«äº†ã€‚

å¯é€‰å±æ€§çš„å€¼å¯ä¸æ˜¯å•å•å¤šäº†ä¸ª `undefined` ç±»å‹è€Œå·²ï¼Œè¦ä¸ç„¶ä¸Šé¢çš„ç¤ºä¾‹éƒ½æ²¡æ³•é€šè¿‡äº†ã€‚

## Get Optionalï¼ˆä¿ç•™æ‰€æœ‰å¯é€‰å­—æ®µï¼‰

> [æŒ‘æˆ˜è¦æ±‚](https://github.com/type-challenges/type-challenges/blob/main/questions/00059-hard-get-optional/README.zh-CN.md) 
> [åœ¨çº¿ç¤ºä¾‹](https://www.typescriptlang.org/play?ssl=26&ssc=2&pln=24&pc=1#code/PQKgUABBCsCcEFoIHECmAXCB5ADuglgPYB2AhgDaSII21UBGAnhAFoAWqnxA5hABQABAF4cu3AJQQAxIAe1QH1p0gK4FyAZ2n5iAM1QAnKlSlGIgDIzAd24GoAPgiBGV0DsMYBlrQFeBgCqVA3-6BF6MAw-4CJrQHPxEAAKAEoQgJymgNvxXoAUsYDziYBADJYQgHnagA3OgBtZgOV+yvjkgN4+gNHqAAZo6LgEJBQAPAAqVsXegKfRRYC78oCaroACRoCQ5oD3yoCQCYDq2oCt1smA0fKAQZrJxTPoqlTojDioEACSEAC8KBgVRGTk1QDeEFqEhABcEMSKALb0egA0EPSkugD8l6roupq8AL42YDACCoAAeywAxuhUAATCDoQjPFbHF7vT7fX4QP5UGbFZI2QAU6ih8Og2Ip6BBAFBygFPzQDQ7oAsf7Y6HQOFU5yBcwhbAAdAArVTcwi6bjAODAEQIADCADkwCBgGBFaAIAB9NXqjXqiCAA3lACFugGO5QCAHqrNaaVRB5YrFsttuU8HsavVNhBDlQANpBCCaCAAa1QjEIWggtQgpHUtQ9AF0QaDocQYeoQqgAI6KfC6WF1KxRiBvK6oABuegglyCkcuEbLYGxirAyrNpoggGlbQCr0YAKVzGJobWst+BuOCFmGtyIgAFFUxQnqPwagoViTrpCDcIAByATDhBcijkVA8VCqYC5NQrq1LFYQsP751uqjTyHoarjxQ1Mq7KoHY6nC5XW73XQAbmeV4PggL4fh4LErCeFFgPRcD-isKDbxnKFHwnA5X3td8jhOM5LkUeNUC0TRYUA1EQIImEiJIuEAWgoC0QgSjqOIWFIKQyNazrEAu27c1AGg5QAAOUAU2teO7C0FVAKgbEAMCVAGq5PVAGPIwAVb0ZZlWXZYBOR5flBWFUVYGAUhiFUAB3PRxTYKVZWsCA6RUtSWTZDlVC5PkBSFEUxVUQhyFyEh5lswAXs0ALE1zEcjSXLc3TPMs6y5QVMAgA)

### é¢˜æ„

å®ç°é«˜çº§å·¥å…·ç±»å‹Â `GetOptional<T>`ï¼Œè¯¥ç±»å‹ä¿ç•™æ‰€æœ‰å¯é€‰å±æ€§ã€‚

ä¾‹å¦‚ï¼š

```ts
// expected to be { bar?: string }
type I = GetOptional<{ foo: number, bar?: string }> 
```

### é¢˜è§£

```ts
type GetOptional<T> = {
  [P in keyof T as T[P] extends Required<T>[P] ? never : P]: T[P]
}


// ä½¿ç”¨ç¤ºä¾‹ï¼šexpected to be { bar?: string }
type I = GetOptional<{ foo: number, bar?: string }>
```

ä¸€å¼€å§‹æˆ‘è¿˜æƒ³ç”¨ `Partial` æ¥è¿›è¡Œå¤„ç†ï¼š

```ts
type GetOptional<T> = {
  [P in keyof T as T[P] extends Partial<T>[P] ? P : never]: T[P]
}
```

å‘ç°è¡Œä¸é€šï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—ç”¨ `Required` æ¥è¿›è¡Œå¤„ç†ã€‚

å…¶å®å°±æ˜¯è·Ÿä¸Šé¢çš„ `Get Required` çš„å¤„ç†ç›¸åï¼Œåªæ˜¯è¿™æ¬¡ç”¨æ¥æ’é™¤æ‰å¿…é€‰å­—æ®µè€Œå·²ã€‚

æ‰€ä»¥å¤„ç†æ­¥éª¤å°±æ˜¯ï¼š

1. ä½¿ç”¨ [as](https://www.typescriptlang.org/docs/handbook/2/mapped-types.html#key-remapping-via-as) é”®çš„é‡æ–°æ˜ å°„
2. åˆ¤æ–­å½“å‰é”®å¯¹åº”çš„å€¼ç±»å‹æ˜¯ä¸æ˜¯å¿…é€‰å­—æ®µ
   - æ˜¯åˆ™è¿”å› `never`
   - å¦åˆ™ä¿ç•™å½“å‰é”®